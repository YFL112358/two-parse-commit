# two-parse-commit
#概要
	MongoDB数据库中操作single-document总是原子性的，然而，涉及multi-document的操作，而不是原子性的。在这些情况下，使用two-parse-
	
	commit，提供这些类型的multi-document操作支持
#背景
	当执行一个由连续操作组成的事务时，某些问题出现了，比如：
	如果一个操作失败，比如，丢失信息，丢失回复，中途断电等，事务内的之前的操作必须 ” 回滚 “到之前的状态（就是 “all or nothing” 里面的 “nothing”）。
	遇到这种情况，two-parse-commit 则可以解决这些问题。
#执行阶
	阶段1：请求阶段（commit-request phase，或称表决阶段，voting phase）

	在请求阶段，协调者将通知事务参与者准备提交或取消事务，然后进入表决过程。在表决过程中，参与者将告知协调者自己的决策：同意（事务参与者本地作业执	行成功）或取消（本地作业执行故障）。

	阶段2：提交阶段（commit phase）

	在该阶段，协调者将基于第一个阶段的投票结果进行决策：提交或取消。当且仅当所有的参与者同意提交事务协调者才通知所有的参与者提交事务，否则协调者将通知所有的参与者取消事务。参与者在接收到协调者发来的消息后将执行响应的操作。
	


#对此两个阶段想象出一个场景：
	A组织B、C和D三个人去爬长城：如果所有人都同意去爬长城，那么活动将举行；如果有一人不同意去爬长城，那么活动将取消。用2PC算法解决该问题的过程如下：
	首先A将成为该活动的协调者（Coordinator），B、C和D将成为该活动的参与者（Cohort）。

	阶段1：

	A发邮件给B、C和D，提出下周三去爬山，问是否同意。那么此时A需要等待B、C和D的邮件。

	B、C和D分别查看自己的日程安排表。B、C发现自己在当日没有活动安排，则发邮件告诉A它们同意下周三去爬长城。由于某种原因，D白天没有查看邮件。那么
	此时A、B和C均需要等待。到晚上的时候，D发现了A的邮件，然后查看日程安排，发现周三当天已经有别的安排，那么D回复A说活动参加不了。
	
	阶段2：

	此时A收到了所有活动参与者的邮件，并且A发现D下周三不能去爬山。那么A将发邮件通知B、C和D，下周三爬长城活动取消。

	此时B、C回复A“太可惜了”，D回复A“不好意思”。至此该事务终止。
#案例
  	假设一个情景，你想从账户 A 转钱到账户 B ，MongoDB里，你可以模仿两阶段提交来达到从 A 账户上减去钱并且为 B 账户添加上钱
	
	详情参考：http://docs.mongoing.com/manual-zh/tutorial/perform-two-phase-commits.html#pattern

  
